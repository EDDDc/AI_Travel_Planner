# PRD｜Web 版 AI 旅行规划师（AI Travel Planner）

版本：v1.0（草案）
负责人：产品/研发联合
更新时间：2025-11-06

## 1. 产品概述

AI 旅行规划师旨在简化旅行规划与出行准备流程。用户以语音或文字输入旅行诉求（目的地、日期、预算、偏好等），系统通过大语言模型自动生成包含交通、住宿、景点与餐饮的个性化行程方案，并提供预算估算与费用记录能力，支持云端同步与多设备查看，界面以地图为核心进行交互展示。

## 2. 目标与非目标

目标
- 让用户在 1 分钟内从零到一获得一份可执行的行程初稿。
- 支持语音输入与语音记账，降低操作门槛。
- 生成结果包含交通、住宿、景点、餐饮、每日节奏与时间安排、参考价格。
- 提供预算估算、费用记账与分类汇总报表。
- 行程/预算/偏好数据云端同步，可跨设备查看与编辑。

非目标（v1 不包含）
- 机票/酒店的真实在线预订与支付。
- 实时汇率/天气/航班动态的深度整合（仅做基础信息展示或链接）。
- 跨语言的多国语实时语音翻译（v1 可不做）。

## 3. 用户与场景

核心用户画像
- 轻量自助出行用户：时间紧，希望快速拿到计划。
- 亲子/家庭出行用户：注重节奏、安全与餐饮安排。
- 预算敏感用户：希望预估总花费，并在行程中随手记账。

典型使用场景
- 输入“我想去日本 7 天，预算 1 万，喜欢美食和动漫，带孩子”，系统返回建议行程（含每日安排、交通/住宿/景点/餐厅、预算分配）。
- 行程中随时用语音记账：“今天在新宿吃拉面花了 2000 日元”。
- 多设备查看与调整；在地图上查看每天路线与位置关系。

## 4. 竞品与差异化（简）

- 竞品：小红书攻略+手工安排行程、通用旅游 App 的“行程助手”、部分 AI 行程生成工具。
- 差异化：语音优先、生成后可编辑、地图主视图、预算协同记录、开箱即用的 Docker 部署。

## 5. 范围与里程碑

M1 原型（第1周）
- 前端/后端脚手架；地图底图加载；阿里百炼/讯飞联通打通；最小行程生成

M2 MVP（第2-3周）
- 行程生成（文本/语音），行程保存/编辑/重算；预算估算与语音记账；Supabase 云同步

M3 集成与打磨（第4周）
- 细节优化、异常处理、速率限制；Docker 化与一键运行；README 与演示

M4 提交（第5周）
- GitHub Actions 持续集成；镜像推送阿里云 ACR；提交 PDF（含仓库与说明）

## 6. 详细功能需求

6.1 智能行程规划
- 输入方式：
  - 文字输入：目的地、天数、日期范围、预算、同行人数、偏好标签（美食/亲子/动漫/自然/购物等）。
  - 语音输入：通过浏览器录音 → 语音识别 → 文字解析。
- 生成能力：
  - LLM（阿里百炼）根据参数生成行程结构：按日分组，含交通建议、住宿区域/酒店建议、早中晚餐备选、景点列表与时段，附带人均/总价估算与注意事项。
  - 生成可调参数：节奏偏好（松弛/均衡/紧凑）、预算级别（经济/均衡/高端）。
- 地图呈现：
  - 每日行程在地图上渲染，支持展示 POI 点位，路径预估（调用高德 JS SDK）。
- 行程管理：
  - 新建/保存/重命名/复制/删除。
  - 编辑：手工增删改活动节点、备注、时间段；可对单日“重算建议”。
  - 导出：导出为 PDF/图片（v1 可仅导出 JSON/文本）。

6.2 预算与费用管理
- 预算估算：
  - 由 LLM 根据目的地与偏好给出交通/住宿/餐饮/门票/杂项的区间与建议。
- 费用记录：
  - 手工输入与语音记账（自动解析金额、币种、类别）。
  - 分类汇总、按日/按类别统计与图表展示。
  - 数据与行程绑定，支持离线草稿（前端缓存）与云端同步。

6.3 用户与账户
- 注册/登录：使用 Supabase Auth（邮箱验证码/密码）。
- 用户数据：行程、费用、偏好、设置均与用户关联。
- 隐私：用户可选择是否将行程设为私密或分享链接（v1 可不做分享）。

6.4 设置与密钥管理
- 不在代码中硬编码任何第三方 API Key。
- 后端读取环境变量（服务端调用：阿里百炼、讯飞、地图服务密钥）。
- 前端提供“设置-密钥”页，可暂存用户自有 Key（如非统一提供时），经后端加密存储于数据库专用列或仅会话级缓存。
- 支持不同环境（本地/预发/生产）密钥隔离。

6.5 地图与地点检索
- 高德地图 Web JS SDK：底图、定位、地点检索、驾/步/公交路线规划展示（用于可视化，不作为导航承诺）。
- 以地点经纬度为行程活动节点的定位依据。

6.6 语音能力
- 语音转文本（ASR）：科大讯飞 Web API 或替代方案。
- 语音记账：识别后做金额/币种/类别抽取与确认。

6.7 通知与分享（v1 可选）
- 行程提醒（本地提醒）；行程分享链接（登录可控）。

## 7. 非功能需求

- 性能：行程生成 < 15 秒；地图渲染 < 2 秒；语音识别 < 5 秒。
- 可用性：关键路径可用率 99%；错误有清晰提示与重试。
- 安全：不在前端暴露服务端密钥；鉴权基于 Supabase Auth；输入合法性校验与速率限制。
- 隐私：遵循最小化收集原则；用户可删除数据。
- 可维护性：模块清晰，接口契约稳定，日志与错误码统一。

## 8. 系统架构与技术选型

- 前端：Vue 3 + Vite + TypeScript；UI 库（Element Plus/Ant Design Vue 二选一）；高德地图 JS SDK；录音（MediaRecorder）。
- 后端：Spring Boot 3 + Java 17；Maven 构建；REST API；调用外部服务（阿里百炼、讯飞、高德）；与 Supabase 交互（PostgREST / 直接 Postgres 驱动）。
- 数据库/认证：Supabase（Postgres + Supabase Auth）。
- AI：阿里云百炼平台（行程生成、预算估算与解析）；提示词与输出结构固定化（JSON Schema）。
- 语音：科大讯飞 Web API（ASR）。
- 部署：Docker 化；Nginx 反向代理前后端；环境变量注入；GitHub Actions 构建并推送镜像至阿里云 ACR。

## 9. 接口设计（v1 草案）

前缀：`/api`

- `POST /auth/signup`，`POST /auth/login`（如走 Supabase 前端 SDK，可不经后端）。
- `POST /itineraries/generate`：根据输入参数调用 LLM 生成行程。
  - 请求：{ destination, dates, days, budget, people, preferences, pace }
  - 响应：{ itineraryId, days: [{date, activities:[{poiId,name,lat,lng,start,end,notes,costEstimate}]}], transport, lodging, foods, budgetEstimate }
- `GET /itineraries/{id}`，`PUT /itineraries/{id}`，`DELETE /itineraries/{id}`
- `POST /itineraries/{id}/recalculate`：对单日/整体重算建议。
- `GET /places/search?q=...`：地点检索（代理高德）。
- `POST /budget/entries`，`GET /budget/entries?itineraryId=...`：费用记录与查询。
- `POST /voice/asr`：上传音频做 ASR，返回文本。
- `GET /settings`，`PUT /settings`：保存个人偏好/密钥占位（如需要）。

鉴权与安全
- 需要登录的接口携带 JWT（Supabase Auth）。
- 服务端代理外部服务，前端不直连敏感 API。

## 10. 数据模型（简要）

User
- id, email, displayName, createdAt

Itinerary
- id, userId, title, destination, startDate, endDate, days, people, budgetTarget, preferences(json), pace, createdAt, updatedAt

ItineraryDay
- id, itineraryId, date, notes

Activity
- id, itineraryDayId, type(enum: sight, food, transport, rest, shopping, custom), name, poiId, lat, lng, start, end, costEstimate, extra(json)

BudgetEntry
- id, itineraryId, date, amount, currency, category(enum: transport, lodging, food, ticket, shopping, other), note, source(enum: manual, voice), createdAt

UserSettings
- id, userId, locale, currency, aiModel, asrProvider, extra(json)

## 11. 与第三方服务集成

- 阿里云百炼：行程与预算生成/解析；模型与 token 配额管理；提示词模板化、输出 JSON 格式对齐前端渲染。
- 科大讯飞：浏览器录音 → 后端转发 → ASR → 返回文本。
- 高德地图：JS SDK 底图与路线渲染；服务端必要时做地点代理检索以隐藏 Key。
- Supabase：Auth + Postgres；行程/活动/预算/设置持久化。

## 12. 交互流程（关键流）

新建行程（语音）
1) 点击“语音创建”→ 录音 → 识别文本
2) 补充/确认参数（目的地/日期/预算/偏好）
3) 提交 → 生成中（loading）
4) 地图视图呈现每日行程 → 用户可编辑/保存 → 可重算建议

记账（语音）
1) 行程详情页 → 点击“语音记账”
2) 识别文本并解析金额/类别 → 用户确认
3) 入库并刷新统计

## 13. 提示词与输出约束（草案）

- 行程提示词：要求输出标准 JSON，字段含每日安排、建议地点经纬度（如可求得）、时间段与成本预估；若无法给出经纬度，提供可检索的名称与行政区。
- 预算提示词：输出总预算分配（交通/住宿/餐饮/门票/杂项）、人均与汇率假设说明。
- 错误兜底：无法确定时给出可供选择的多方案，并标注不确定性。

## 14. 验收标准

- 功能完整：
  - 文本/语音创建行程，能生成含交通/住宿/景点/餐饮的日程结构。
  - 地图渲染每日 POI 与路径可视化。
  - 预算估算与语音记账可用，统计/筛选正确。
  - 行程/预算/设置与账户关联，云端可同步与拉取。
- 安全合规：
  - 代码库不包含任何明文 API Key；通过环境变量或用户输入配置。
  - 接口鉴权、速率限制与输入校验到位。
- 交付物：
  - GitHub 仓库包含 README（本地与 Docker 一键运行说明）。
  - 提交 PDF（含仓库地址与 README 内容）。
  - 提供可直接拉取运行的 Docker 镜像；GitHub Actions 构建并推送至阿里云 ACR。

## 15. 风险与对策

- 第三方配额/速率限制：加入重试与退避策略，重要调用做缓存。
- 地点经纬度与路线精确度：以名称检索+用户确认为主，标注不确定性。
- 语音识别准确率：提供手动纠错界面与二次确认流程。
- 成本与延迟：异步生成、进度提示、分步加载。

## 16. 指标（基础版）

- 生成成功率、平均生成时延、二次编辑率
- 记账留存率、日活、行程保存率

## 17. 交付与提交要求（对应作业）

- 提交 PDF 文件，包含 GitHub 仓库地址与使用说明（README 摘要）。
- 代码托管到 GitHub，提供可直接下载运行的 Docker 镜像与运行文档。
- 若未使用阿里云统一 Key，需在 README 中提供可用 Key（至少 3 个月）供验收；建议以“设置-密钥”页输入为主，避免硬编码。
- 尽量保留详尽的 Git 提交记录。

